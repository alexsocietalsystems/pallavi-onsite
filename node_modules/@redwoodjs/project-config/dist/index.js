"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/index.ts
var src_exports = {};
__export(src_exports, {
  BundlerEnum: () => BundlerEnum,
  TargetEnum: () => TargetEnum,
  ensurePosixPath: () => ensurePosixPath,
  getBaseDir: () => getBaseDir,
  getBaseDirFromFile: () => getBaseDirFromFile,
  getConfig: () => getConfig,
  getConfigPath: () => getConfigPath,
  getPaths: () => getPaths,
  getRawConfig: () => getRawConfig,
  importStatementPath: () => importStatementPath,
  processPagesDir: () => processPagesDir,
  resolveFile: () => resolveFile
});
module.exports = __toCommonJS(src_exports);

// src/config.ts
var import_fs = __toESM(require("fs"));
var import_toml = __toESM(require("@iarna/toml"));
var import_deepmerge = __toESM(require("deepmerge"));
var import_string_env_interpolation = require("string-env-interpolation");

// src/configPath.ts
var import_findup_sync = __toESM(require("findup-sync"));
var CONFIG_FILE_NAME = "redwood.toml";
var getConfigPath = (cwd = process.env.RWJS_CWD ?? process.cwd()) => {
  const configPath = (0, import_findup_sync.default)(CONFIG_FILE_NAME, { cwd });
  if (!configPath) {
    throw new Error(
      `Could not find a "${CONFIG_FILE_NAME}" file, are you sure you're in a Redwood project?`
    );
  }
  return configPath;
};

// src/config.ts
var TargetEnum = /* @__PURE__ */ ((TargetEnum2) => {
  TargetEnum2["NODE"] = "node";
  TargetEnum2["BROWSER"] = "browser";
  TargetEnum2["REACT_NATIVE"] = "react-native";
  TargetEnum2["ELECTRON"] = "electron";
  return TargetEnum2;
})(TargetEnum || {});
var BundlerEnum = /* @__PURE__ */ ((BundlerEnum2) => {
  BundlerEnum2["WEBPACK"] = "webpack";
  BundlerEnum2["VITE"] = "vite";
  return BundlerEnum2;
})(BundlerEnum || {});
var DEFAULT_CONFIG = {
  web: {
    title: "Redwood App",
    host: "localhost",
    port: 8910,
    path: "./web",
    target: "browser" /* BROWSER */,
    bundler: "webpack" /* WEBPACK */,
    includeEnvironmentVariables: [],
    apiUrl: "/.redwood/functions",
    fastRefresh: true,
    a11y: true,
    sourceMap: false
  },
  api: {
    title: "Redwood App",
    host: "localhost",
    port: 8911,
    path: "./api",
    target: "node" /* NODE */,
    schemaPath: "./api/db/schema.prisma",
    serverConfig: "./api/server.config.js",
    debugPort: 18911
  },
  browser: {
    open: false
  },
  generate: {
    tests: true,
    stories: true,
    nestScaffoldByModel: true
  },
  notifications: {
    versionUpdates: []
  },
  experimental: {
    opentelemetry: {
      enabled: false,
      apiSdk: void 0
    },
    studio: {
      inMemory: false,
      graphiql: {
        endpoint: "graphql",
        authImpersonation: {
          authProvider: void 0,
          userId: void 0,
          email: void 0,
          roles: void 0,
          jwtSecret: "secret"
        }
      }
    }
  }
};
var getConfig = (configPath = getConfigPath()) => {
  try {
    return (0, import_deepmerge.default)(DEFAULT_CONFIG, getRawConfig(configPath));
  } catch (e) {
    throw new Error(`Could not parse "${configPath}": ${e}`);
  }
};
function getRawConfig(configPath = getConfigPath()) {
  try {
    return import_toml.default.parse((0, import_string_env_interpolation.env)(import_fs.default.readFileSync(configPath, "utf8")));
  } catch (e) {
    throw new Error(`Could not parse "${configPath}": ${e}`);
  }
}

// src/paths.ts
var import_fs2 = __toESM(require("fs"));
var import_path = __toESM(require("path"));
var import_fast_glob = __toESM(require("fast-glob"));
var PATH_API_DIR_FUNCTIONS = "api/src/functions";
var PATH_RW_SCRIPTS = "scripts";
var PATH_API_DIR_GRAPHQL = "api/src/graphql";
var PATH_API_DIR_CONFIG = "api/src/config";
var PATH_API_DIR_MODELS = "api/src/models";
var PATH_API_DIR_LIB = "api/src/lib";
var PATH_API_DIR_GENERATORS = "api/generators";
var PATH_API_DIR_SERVICES = "api/src/services";
var PATH_API_DIR_DIRECTIVES = "api/src/directives";
var PATH_API_DIR_SRC = "api/src";
var PATH_WEB_ROUTES = "web/src/Routes";
var PATH_WEB_DIR_LAYOUTS = "web/src/layouts/";
var PATH_WEB_DIR_PAGES = "web/src/pages/";
var PATH_WEB_DIR_COMPONENTS = "web/src/components";
var PATH_WEB_DIR_SRC = "web/src";
var PATH_WEB_DIR_SRC_APP = "web/src/App";
var PATH_WEB_DIR_SRC_INDEX = "web/src/index";
var PATH_WEB_INDEX_HTML = "web/src/index.html";
var PATH_WEB_DIR_GENERATORS = "web/generators";
var PATH_WEB_DIR_CONFIG = "web/config";
var PATH_WEB_DIR_CONFIG_WEBPACK = "web/config/webpack.config.js";
var PATH_WEB_DIR_CONFIG_VITE = "web/vite.config";
var PATH_WEB_DIR_CONFIG_POSTCSS = "web/config/postcss.config.js";
var PATH_WEB_DIR_CONFIG_STORYBOOK_CONFIG = "web/config/storybook.config.js";
var PATH_WEB_DIR_CONFIG_STORYBOOK_PREVIEW = "web/config/storybook.preview.js";
var PATH_WEB_DIR_CONFIG_STORYBOOK_MANAGER = "web/config/storybook.manager.js";
var PATH_WEB_DIR_DIST = "web/dist";
var getBaseDir = (configPath = getConfigPath()) => {
  return import_path.default.dirname(configPath);
};
var getBaseDirFromFile = (file) => {
  return getBaseDir(getConfigPath(import_path.default.dirname(file)));
};
var resolveFile = (filePath, extensions = [".js", ".tsx", ".ts", ".jsx"]) => {
  for (const extension of extensions) {
    const p = `${filePath}${extension}`;
    if (import_fs2.default.existsSync(p)) {
      return p;
    }
  }
  return null;
};
var getPaths = (BASE_DIR = getBaseDir()) => {
  const routes = resolveFile(import_path.default.join(BASE_DIR, PATH_WEB_ROUTES));
  const { schemaPath } = getConfig(getConfigPath(BASE_DIR)).api;
  const schemaDir = import_path.default.dirname(schemaPath);
  const paths = {
    base: BASE_DIR,
    generated: {
      base: import_path.default.join(BASE_DIR, ".redwood"),
      schema: import_path.default.join(BASE_DIR, ".redwood/schema.graphql"),
      types: {
        includes: import_path.default.join(BASE_DIR, ".redwood/types/includes"),
        mirror: import_path.default.join(BASE_DIR, ".redwood/types/mirror")
      },
      prebuild: import_path.default.join(BASE_DIR, ".redwood/prebuild")
    },
    scripts: import_path.default.join(BASE_DIR, PATH_RW_SCRIPTS),
    api: {
      base: import_path.default.join(BASE_DIR, "api"),
      dataMigrations: import_path.default.join(BASE_DIR, schemaDir, "dataMigrations"),
      db: import_path.default.join(BASE_DIR, schemaDir),
      dbSchema: import_path.default.join(BASE_DIR, schemaPath),
      functions: import_path.default.join(BASE_DIR, PATH_API_DIR_FUNCTIONS),
      graphql: import_path.default.join(BASE_DIR, PATH_API_DIR_GRAPHQL),
      lib: import_path.default.join(BASE_DIR, PATH_API_DIR_LIB),
      generators: import_path.default.join(BASE_DIR, PATH_API_DIR_GENERATORS),
      config: import_path.default.join(BASE_DIR, PATH_API_DIR_CONFIG),
      services: import_path.default.join(BASE_DIR, PATH_API_DIR_SERVICES),
      directives: import_path.default.join(BASE_DIR, PATH_API_DIR_DIRECTIVES),
      src: import_path.default.join(BASE_DIR, PATH_API_DIR_SRC),
      dist: import_path.default.join(BASE_DIR, "api/dist"),
      types: import_path.default.join(BASE_DIR, "api/types"),
      models: import_path.default.join(BASE_DIR, PATH_API_DIR_MODELS)
    },
    web: {
      routes,
      base: import_path.default.join(BASE_DIR, "web"),
      pages: import_path.default.join(BASE_DIR, PATH_WEB_DIR_PAGES),
      components: import_path.default.join(BASE_DIR, PATH_WEB_DIR_COMPONENTS),
      layouts: import_path.default.join(BASE_DIR, PATH_WEB_DIR_LAYOUTS),
      src: import_path.default.join(BASE_DIR, PATH_WEB_DIR_SRC),
      generators: import_path.default.join(BASE_DIR, PATH_WEB_DIR_GENERATORS),
      app: resolveFile(import_path.default.join(BASE_DIR, PATH_WEB_DIR_SRC_APP)),
      index: resolveFile(import_path.default.join(BASE_DIR, PATH_WEB_DIR_SRC_INDEX)),
      html: import_path.default.join(BASE_DIR, PATH_WEB_INDEX_HTML),
      config: import_path.default.join(BASE_DIR, PATH_WEB_DIR_CONFIG),
      webpack: import_path.default.join(BASE_DIR, PATH_WEB_DIR_CONFIG_WEBPACK),
      viteConfig: resolveFile(import_path.default.join(BASE_DIR, PATH_WEB_DIR_CONFIG_VITE)),
      postcss: import_path.default.join(BASE_DIR, PATH_WEB_DIR_CONFIG_POSTCSS),
      storybookConfig: import_path.default.join(
        BASE_DIR,
        PATH_WEB_DIR_CONFIG_STORYBOOK_CONFIG
      ),
      storybookPreviewConfig: import_path.default.join(
        BASE_DIR,
        PATH_WEB_DIR_CONFIG_STORYBOOK_PREVIEW
      ),
      storybookManagerConfig: import_path.default.join(
        BASE_DIR,
        PATH_WEB_DIR_CONFIG_STORYBOOK_MANAGER
      ),
      dist: import_path.default.join(BASE_DIR, PATH_WEB_DIR_DIST),
      types: import_path.default.join(BASE_DIR, "web/types")
    }
  };
  import_fs2.default.mkdirSync(paths.generated.types.includes, { recursive: true });
  import_fs2.default.mkdirSync(paths.generated.types.mirror, { recursive: true });
  return paths;
};
var processPagesDir = (webPagesDir = getPaths().web.pages) => {
  const pagePaths = import_fast_glob.default.sync("**/*Page.{js,jsx,ts,tsx}", {
    cwd: webPagesDir,
    ignore: ["node_modules"]
  });
  return pagePaths.map((pagePath) => {
    const p = import_path.default.parse(pagePath);
    const importName = p.dir.replace(/\//g, "");
    const importPath = importStatementPath(
      import_path.default.join(webPagesDir, p.dir, p.name)
    );
    const importStatement = `const ${importName} = { name: '${importName}', loader: import('${importPath}') }`;
    return {
      importName,
      const: importName,
      importPath,
      path: import_path.default.join(webPagesDir, pagePath),
      importStatement
    };
  });
};
var ensurePosixPath = (path2) => {
  let posixPath = path2;
  if (process.platform === "win32") {
    if (/^[A-Z]:\\/.test(path2)) {
      const drive = path2[0].toLowerCase();
      posixPath = `/${drive}/${path2.substring(3)}`;
    }
    posixPath = posixPath.replace(/\\/g, "/");
  }
  return posixPath;
};
var importStatementPath = (path2) => {
  let importPath = path2;
  if (process.platform === "win32") {
    importPath = importPath.replaceAll("\\", "/");
  }
  return importPath;
};
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  BundlerEnum,
  TargetEnum,
  ensurePosixPath,
  getBaseDir,
  getBaseDirFromFile,
  getConfig,
  getConfigPath,
  getPaths,
  getRawConfig,
  importStatementPath,
  processPagesDir,
  resolveFile
});
